<svg xmlns="http://www.w3.org/2000/svg" width="900" height="640" viewBox="0 0 900 640">
  <rect width="900" height="640" fill="white"/>

  <text x="450" y="38" font-family="monospace" font-size="18" font-weight="bold"
        text-anchor="middle" dominant-baseline="middle" fill="#2c3e50">
    Bond Terms → Cash Flows → Discount → Price: Data Flow
  </text>

  <!-- Step 1: Bond Terms Input -->
  <rect x="50" y="70" width="160" height="110" rx="12" fill="#eaf6fb" stroke="#3498db" stroke-width="2"/>
  <text x="130" y="108" font-family="monospace" font-size="12" font-weight="bold"
        text-anchor="middle" dominant-baseline="middle" fill="#2980b9">Bond Terms</text>
  <text x="130" y="128" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">face_value: 100.0</text>
  <text x="130" y="143" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">coupon_rate: 4.25%</text>
  <text x="130" y="158" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">maturity: 2034-02-15</text>

  <!-- Arrow 1→2 -->
  <line x1="210" y1="125" x2="278" y2="125" stroke="#3498db" stroke-width="2.5" marker-end="url(#a1)"/>

  <!-- Step 2: Coupon Date Generation -->
  <rect x="280" y="70" width="170" height="110" rx="12" fill="#eafaf1" stroke="#2ecc71" stroke-width="2"/>
  <text x="365" y="100" font-family="monospace" font-size="12" font-weight="bold"
        text-anchor="middle" dominant-baseline="middle" fill="#27ae60">Coupon Dates</text>
  <text x="365" y="118" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">Walk back from maturity</text>
  <text x="365" y="133" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">every 6 months</text>
  <text x="365" y="153" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">→ list[date]</text>
  <text x="365" y="168" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">Handle stubs + EOM</text>

  <!-- Arrow 2→3 -->
  <line x1="450" y1="125" x2="518" y2="125" stroke="#2ecc71" stroke-width="2.5" marker-end="url(#a2)"/>

  <!-- Step 3: Time Fractions -->
  <rect x="520" y="70" width="160" height="110" rx="12" fill="#fef9e7" stroke="#e67e22" stroke-width="2"/>
  <text x="600" y="100" font-family="monospace" font-size="12" font-weight="bold"
        text-anchor="middle" dominant-baseline="middle" fill="#d35400">Year Fractions</text>
  <text x="600" y="118" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">Act/Act ISDA convention</text>
  <text x="600" y="133" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">settlement → each coupon</text>
  <text x="600" y="153" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">→ np.ndarray[float64]</text>
  <text x="600" y="168" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">[0.49, 0.99, 1.49 …]</text>

  <!-- Arrow 3→4 -->
  <line x1="680" y1="125" x2="748" y2="125" stroke="#e67e22" stroke-width="2.5" marker-end="url(#a3)"/>

  <!-- Step 4: Cash Amounts -->
  <rect x="750" y="70" width="120" height="110" rx="12" fill="#fef5fb" stroke="#9b59b6" stroke-width="2"/>
  <text x="810" y="100" font-family="monospace" font-size="12" font-weight="bold"
        text-anchor="middle" dominant-baseline="middle" fill="#8e44ad">Amounts</text>
  <text x="810" y="120" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">np.ndarray[float64]</text>
  <text x="810" y="138" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">[2.125, 2.125, …</text>
  <text x="810" y="153" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#444">102.125]</text>

  <!-- Vertical arrow down from times + amounts -->
  <line x1="600" y1="180" x2="600" y2="248" stroke="#e67e22" stroke-width="2" marker-end="url(#a3)"/>
  <line x1="810" y1="180" x2="810" y2="220" stroke="#9b59b6" stroke-width="2"/>
  <line x1="810" y1="220" x2="450" y2="220" stroke="#9b59b6" stroke-width="2"/>
  <line x1="450" y1="220" x2="450" y2="248" stroke="#9b59b6" stroke-width="2" marker-end="url(#a4)"/>

  <!-- Step 5: Discount Factors (vectorized) -->
  <rect x="300" y="250" width="600" height="90" rx="12" fill="#f8f9fa" stroke="#2c3e50" stroke-width="2"/>
  <text x="600" y="278" font-family="monospace" font-size="13" font-weight="bold"
        text-anchor="middle" dominant-baseline="middle" fill="#2c3e50">Discount Factors — Vectorized NumPy</text>
  <text x="600" y="298" font-family="monospace" font-size="11"
        text-anchor="middle" dominant-baseline="middle" fill="#555">
    df = 1.0 / (1 + ytm/freq) ** (times * freq)   ←  single C-level BLAS call
  </text>
  <text x="600" y="318" font-family="monospace" font-size="10"
        text-anchor="middle" dominant-baseline="middle" fill="#888">
    np.dot(amounts, df)  →  dirty_price   (no Python loop)
  </text>

  <!-- Arrow 5→6 -->
  <line x1="600" y1="340" x2="600" y2="398" stroke="#2c3e50" stroke-width="2.5" marker-end="url(#a5)"/>

  <!-- Step 6: Decomposition -->
  <rect x="200" y="400" width="200" height="80" rx="12" fill="#eafaf1" stroke="#2ecc71" stroke-width="2"/>
  <text x="300" y="432" font-family="monospace" font-size="12" font-weight="bold"
        text-anchor="middle" dominant-baseline="middle" fill="#27ae60">Dirty Price</text>
  <text x="300" y="452" font-family="monospace" font-size="10"
        text-anchor="middle" dominant-baseline="middle" fill="#444">Σ(amounts × df)</text>
  <text x="300" y="468" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#888">what you actually pay</text>

  <rect x="500" y="400" width="200" height="80" rx="12" fill="#eafaf1" stroke="#27ae60" stroke-width="2"/>
  <text x="600" y="432" font-family="monospace" font-size="12" font-weight="bold"
        text-anchor="middle" dominant-baseline="middle" fill="#27ae60">Accrued Interest</text>
  <text x="600" y="452" font-family="monospace" font-size="10"
        text-anchor="middle" dominant-baseline="middle" fill="#444">coupon × (days_since/days_in_period)</text>
  <text x="600" y="468" font-family="monospace" font-size="9"
        text-anchor="middle" dominant-baseline="middle" fill="#888">day count convention applied</text>

  <!-- Arrows to clean price -->
  <line x1="300" y1="480" x2="360" y2="538" stroke="#2ecc71" stroke-width="2" marker-end="url(#a2)"/>
  <line x1="600" y1="480" x2="540" y2="538" stroke="#2ecc71" stroke-width="2" marker-end="url(#a2)"/>

  <!-- Step 7: Clean Price -->
  <rect x="350" y="540" width="200" height="70" rx="12" fill="#eaf6fb" stroke="#3498db" stroke-width="3"/>
  <text x="450" y="568" font-family="monospace" font-size="14" font-weight="bold"
        text-anchor="middle" dominant-baseline="middle" fill="#2980b9">Clean Price</text>
  <text x="450" y="588" font-family="monospace" font-size="10"
        text-anchor="middle" dominant-baseline="middle" fill="#555">dirty − accrued   ← market quote</text>

  <!-- Markers -->
  <defs>
    <marker id="a1" markerWidth="8" markerHeight="6" refX="6" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#3498db"/>
    </marker>
    <marker id="a2" markerWidth="8" markerHeight="6" refX="6" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#2ecc71"/>
    </marker>
    <marker id="a3" markerWidth="8" markerHeight="6" refX="6" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#e67e22"/>
    </marker>
    <marker id="a4" markerWidth="8" markerHeight="6" refX="6" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#9b59b6"/>
    </marker>
    <marker id="a5" markerWidth="8" markerHeight="6" refX="6" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#2c3e50"/>
    </marker>
  </defs>
</svg>
